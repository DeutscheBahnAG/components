@import '@bahn-x/dbx-foundation/abstracts.scss';

.dbx-textfield {
  @include dbx-focus-ring(
    $focus-selector: '.dbx-textfield--focus',
    $border: true
  );
  align-items: stretch;
  background-color: dbx-background-color('input');
  border: dbx-border-width('input') solid dbx-border-color('input');
  box-sizing: border-box;
  color: dbx-text-color('primary');
  display: inline-flex;
  font-family: dbx-font-family('copy');

  &:not(.dbx-textfield--disabled) {
    cursor: text;
  }

  &:not(.dbx-textfield--disabled):hover {
    border-color: dbx-border-color('input.hover');
  }

  &.dbx-textfield--disabled,
  &.dbx-textfield--readonly {
    background: dbx-background-color('input.disabled');
    border-color: dbx-border-color('input.disabled');
  }

  &.dbx-textfield--disabled {
    color: dbx-text-color('disabled');
  }

  /**
   * 1. Remove red shadow when validation fails (Firefox)
   */
  input,
  textarea {
    border: 0;
    background: transparent;
    box-shadow: none; /* 1 */
    color: inherit;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    line-height: inherit;
    flex: 1;
    margin: 0;
    outline: 0;
  }

  input::-ms-clear {
    display: none;
  }

  ::placeholder {
    color: rgba(dbx-text-color('secondary'), 0.5);
    font-style: italic;
  }
}

.dbx-textfield--textarea {
  overflow: hidden;
  position: relative;

  &::before,
  &::after {
    background: linear-gradient(to top,
    dbx-background-color('input'),
    rgba(dbx-background-color('input'), 0));
    bottom: 0;
    content: '';
    height: dbx-spacing('s');
    pointer-events: none;
    position: absolute;
    z-index: 1;
  }

  &::before {
    top: 0;
    transform: rotate(180deg);
  }
}

.dbx-textfield-prefix,
.dbx-textfield-suffix {
  color: dbx-text-color('secondary');
  transition: transform 0.2s;
}

.dbx-textfield__inline-label {
  color: dbx-text-color('secondary');
  pointer-events: none;
  position: absolute;
  transition: all 0.2s;
  transform-origin: 0 0;

  .dbx-textfield--disabled & {
    color: inherit;
  }
}

/**
  * 1. Calculating the scaling from M to S.
  * 2. Prefer `scale` over `font-size` for smooth transitions.
  */
.dbx-textfield--focus .dbx-textfield__inline-label,
.dbx-textfield--filled .dbx-textfield__inline-label {
  $scale-down: dbx-font-size('copy', 's') / dbx-font-size('copy', 'm'); /* 1 */
  transform: scale(#{$scale-down}) translateY(-12px); /* 2 */
}

.dbx-textfield--focus label {
  color: dbx-text-color('primary');
}

.dbx-textfield.dbx-textfield--disabled label {
  color: inherit;
}

.dbx-textfield--inline-label {
  ::placeholder {
    color: transparent;
    transition: color 0.2;
  }

  &.dbx-textfield--focus ::placeholder {
    color: dbx-text-color('secondary');
  }

  input,
  &.dbx-textfield--filled .dbx-textfield-prefix,
  &.dbx-textfield--filled .dbx-textfield-suffix,
  &.dbx-textfield--focus .dbx-textfield-prefix,
  &.dbx-textfield--focus .dbx-textfield-suffix {
    transform: translateY(8px);
  }
}

@each $size in (xl l m s xs) {
  .dbx-textfield--#{$size} {
    $horizontal-padding: dbx-component-horizontal-padding($size, 'input');
    $vertical-padding: dbx-component-vertical-padding($size, 'input');

    @include dbx-component-text-style($size, 'input');

    border-radius: dbx-border-radius($size);
    min-height: dbx-size($size);

    input,
    textarea,
    .dbx-textfield-prefix {
      padding-left: $horizontal-padding;
    }

    input,
    textarea,
    .dbx-textfield-suffix {
      padding-right: $horizontal-padding;
    }

    /**
      * 1. Equals a Thin Space character
      * 2. Icons/Buttons should have equal margin to the border on all sides
      */
    .dbx-textfield-prefix {
      margin-right: calc(0.15em - #{$horizontal-padding}); /* 1 */

      > * {
        display: block; /* 2 */
        margin-right: 0.15em;
        transform: translateX(#{$vertical-padding - $horizontal-padding}); /* 2 */
      }
    }

    .dbx-textfield-suffix {
      margin-left: calc(0.15em - #{$horizontal-padding}); /* 1 */

      > * {
        display: block; /* 2 */
        margin-right: 0.15em;
        transform: translateX(#{$horizontal-padding - $vertical-padding}); /* 2 */
      }
    }

    .dbx-textfield--textarea {
      &::before,
      &::after {
        left: $horizontal-padding;
        right: $horizontal-padding;
      }
    }

    .dbx-textfield__inline-label {
      margin-left: $horizontal-padding;
    }

    input,
    textarea,
    .dbx-textfield-prefix,
    .dbx-textfield-suffix,
    .dbx-textfield__inline-label {
      border-radius: dbx-border-radius($size);
      padding-bottom: $vertical-padding;
      padding-top: $vertical-padding;
    }
  }
}

/**
  * 3. Negative margins as Buttons are higher than the expected line-height
  */
.dbx-textfield {
  @each $size in (xl l m s xs) {
    .dbx-button--#{$size} {
      margin: #{(dbx-line-height('copy', 'm') - dbx-size($size)) / 2};
    }
  }
}
